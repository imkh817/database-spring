# 인덱스를 사용하면 데이터 조회 속도가 빨라진다는데 인덱스가 뭐야 ❓

데이터베이스의 성능을 향상시키는 핵심 도구 중 하나로, 인덱스(Index)는 데이터 검색과 정렬을 효율적으로 처리하는 데에 중요한 역할을 한다.

## 1. 인덱스의 개념
인덱스는 특정 열(컬럼)의 값을 기반으로 데이터베이스 테이블의 레코드들을 빠르게 찾을 수 있도록 도와주는 데이터 구조이다. 이는 검색 속도를 향상시키는 동시에 데이터의 정렬을 가능케 한다.
다양한 종류의 인덱스가 있고, 다양한 인덱스들은 다양한 구조를 사용한다.
나는 주로 데이터베이스 시스템에서 기본적인 인덱스 형태로 사용되는 B-Tree 인덱스를 알아보겠다!
## 2. B-Tree 인덱스의 작동 원리

### 균형 트리의 개념
균형 트리 구조에서 데이터가 저장되는 공간을 `노드` 라고 한다.

루트 노드 : 노드의 가장 상위 노드 <br>
리프 노드 : 제일 마지막에 존재하는 노드 <br>
중간 노드 : 루트 노드와 리프 노드의 중간에 끼인 노드 <br>

아래의 사진과 같이 테이블이 있을 떄 MMM이라는 데이터를 조회하게 되면 모든 데이터를 일일히 조회하게 된다.<br>
즉, MMM이라는 데이터의 조회를 위해 3페이지를 검색하게 되었다.

![테이블](https://blog.kakaocdn.net/dn/vBc8c/btsFt6egxbM/AmM2P84wougMQCaCJLObNK/img.png)

하지만 아래와 같이 균형 트리 구조로 인덱스를 설정하게 되면 2페이지만 검색할 수 있게 변경되었다.

![인덱스](https://blog.kakaocdn.net/dn/lKwij/btsFs0yvkYq/tKs2uNOpZrBze6SXLhko4k/img.png)

👇 기존 3페이지를 검색해야할 걸 2페이지만 검색하면 되게 변경

![인덱스](https://blog.kakaocdn.net/dn/bKbMa9/btsFlOthQ8O/pDF2tcQNAP0aMkwUHBJpTK/img.png)

# 인덱스를 사용하면 속도가 빨라지네 ! 그럼 무작정 인덱스를 써도 괜찮을까 ❓
답변은 No다. 이유를 한번 알아보자 ❗️

앞서 인덱스를 사용하면 속도가 빨라지는 것을 확인할 수 있었다. 하지만 이건 엄연히 select 즉, 조회할때만 빨라지게 되는 것이다 ❗️   <br>
insert,update,delete시에는 성능이 더 나빠지게된다. 그 이유는 바로 `페이지 분할` 이라는 작업이 발생하기 때문이다. 

## 페이지 분할

👇 아래 그림과 같이 III를 삽입했다고 가정해보자. 이 경우 원래 있던 노드 칸에 삽입을 한거라 크게 속도면에서 차이가 나지 않는다.

![III삽입](https://blog.kakaocdn.net/dn/svmBU/btsFsm9vp6K/a5GfHk97nwuiXnl1auyUkK/img.png)

👇 하지만 GGG를 삽입하게 되면 페이지의 용량이 꽉차 페이지를 분할하게 된다. 이 분할하는 과정에서 더 많은 시간이 소요되게 된다.

![GGG 삽입](https://blog.kakaocdn.net/dn/dmtuSF/btsFs3IMLF4/RAoZDcrkxRDQlCOM8Ihs40/img.png)

# 요약 ✍🏻

흔히 인덱스를 사용하면 빨리진다고 얘기를 한다. 인덱스에는 여러가지 종류의
인덱스가 있는데 우리가 주로 사용하는 인덱스는 B-tree인덱스이다.
우리가 테이블을 생성할 때 흔히 오브젝트를 생성한다고 하는데 인덱스도 마찬가지로 오브젝트라고 생각하면 되고
인덱스가 생성되면 테이블과 매핑된 또 하나의 테이블이 생성되었다고 생각하면 쉽게 이해할 수 있다.

그럼 테이블이 하나 더 생성되었는데 어떻게 속도가 더 빨라질 수 있을까 라는 의문을 가지게 될 수 있다.
인덱스의 저장방식은 인덱스 컬럼 기준으로 `sort`되어서 저장되어 있다.
보통 테이블은 물리적으로 흩어져서 저장되어 있기 때문에 어떤 특정 조건의 데이터를 찾으려면 테이블 풀 스캔을 하게 된다.
하지만 인덱스는 정렬되어서 저장되어 있기 때문에 특정조건의 데이터를 검색할 때 시작점을 지정해서 시작점 부터 스캔할 수 있다.
인덱스에서 먼저 데이터를 찾은 다음에 그 테이블에 매핑된 곳으로 가서 나머지 데이터를 꺼내오는 방식이다.
매핑 방식은 인덱스가 해당 테이블의 블럭에 주소를 가지고 있다.

### 그럼 어떤 컬럼을 인덱스로 설정해놔야 효율적일까❓
어떤 특정 조건의 데이터를 찾을 떄 유용하니 where절에 자주 쓰는 컬럼명과 order by로 자주 사용하는 컬럼명(인덱스는 sort가 되어있기때문에 order by를 굳이 할 필요없이 인덱스에서 바로 꺼내면 되기 때문) 을 인덱스로
설정해놓는 것이 효율적이다

### 인덱스를 사용하는 것이 무조건 효율적인것 일까 ❓

그건 아니다. 인덱스 손익분기점이라는 것이 있는데 테이블이 가지고 있는 전체 데이터양의 10~15프로
이내의 데이터가 출력이 될때에만 인덱스를 사용하는 것이 효율적이고, 그 이상이 될때는 오히려 풀스캔을 하는 것이 더 효율적이다.