**데이터베이스에서 중요한 동시성 관리 기법인 "락(Lock)"에 대해 깊이 있게 알아보자. 데이터베이스는 여러 사용자가 동시에 데이터에 접근하는 환경에서 운영되기 때문에, 이를 효과적으로 관리하기 위한 락의 원리와 종류, 그리고 실제 활용 상황에 대해 알아보자.**

### **락(Lock)이란 무엇인가요❓**

**락은 데이터베이스에서 여러 트랜잭션이 동시에 공유 자원에 접근할 때 발생할 수 있는 충돌을 방지하고 데이터 일관성을 유지하기 위한 기술적인 개념이다. 락은 일종의 트랜잭션 간 통신 수단으로, 공유 자원의 동시적인 업데이트로 인한 문제를 예방하고 안정적인 데이터베이스 운영을 돕는 역할을 수행한다.**

### **락의 주요 종류  👨🏻‍💻**

-   **공유 락(Shared Lock): 여러 트랜잭션이 동시에 데이터를 읽을 수 있도록 허용하며, 다른 트랜잭션이 해당 데이터를 읽는 동안에만 공유 락을 얻을 수 있다. 읽기 작업에 대한 충돌을 방지하여 데이터 일관성을 유지한다.**
-   **배타 락(Exclusive Lock): 특정 트랜잭션이 데이터를 쓰기 위해 배타적으로 획득하는 락이다. 배타 락을 획득한 트랜잭션이 해당 데이터를 변경 중일 때, 다른 모든 트랜잭션은 대기하게 되어 충돌을 방지한다.**

### **락의 중요성 ❗️**

**락은 데이터베이스에서 동시성과 무결성을 유지하기 위한 핵심적인 도구로 작용한다. 여러 트랜잭션이 동시에 데이터를 조작하려 할 때, 락이 없다면 예측 불가능한 결과와 데이터 일관성 문제가 발생할 수 있다. 락은 이러한 문제를 예방하고 안정적인 트랜잭션 실행을 보장한다.**

### **락의 고려 사항  📌**

-   **락의 범위(Scope of Locks): 락을 설정하는 범위를 어떻게 결정할지가 중요하다. 전체 테이블에 락을 거는 것은 효율적이지 않을 수 있으며, 정확한 범위의 락을 설정하는 것이 중요하다.**
-   **락의 유지 시간(Holding Time of Locks): 락을 설정한 후 유지하는 시간을 최소화하여 동시성을 높이는 것이 중요하다. 그러나 너무 짧게 설정하면 무결성 문제가 발생할 수 있으므로 적절한 시간을 선택해야 한다.**

### **락의 사용 예시 🤩**

**가상의 은행 거래 시스템에서, 사용자 A와 사용자 B가 같은 계좌에서 동시에 자금 이체를 시도하는 상황을 더 자세히 살펴보자.**

-   **초기 상태:**
    -   **계좌 잔액 1,000,000원**
-   **사용자 A의 작업:**
    -    **사용자 A는 계좌에서 100,000원을 이체하려고 합니다.**
    -   **A는 이체를 위해 해당 계좌에 배타 락(Exclusive Lock)을 요청합니다.**
-   **락의 획득:**
    -   **사용자 A가 배타 락을 획득하면 해당 계좌는 다른 사용자의 접근을 차단합니다.**
    -   **다른 트랜잭션이 해당 계좌에 접근하려고 하면 대기 상태로 전환됩니다.**
-   **사용자 A의 작업 수행:**
    -   **사용자 A는 락을 획득한 상태에서 계좌 잔액을 조회하고 100,000원을 차감하여 업데이트합니다.**
-   **사용자 B의 작업:**
    -   **동시에, 사용자 B도 같은 계좌에서 50,000원을 이체하려고 합니다.**
    -   **사용자 B는 이체를 위해 해당 계좌에 배타 락을 요청합니다.**
-   **락의 충돌:**
    -   **사용자 B의 배타 락 요청이 들어왔지만, 이미 사용자 A가 해당 계좌에 배타 락을 획득한 상태입니다.**
    -   **데이터베이스는 사용자 B를 대기 상태로 전환합니다.**
-   **사용자 A의 작업 완료 및 락 해제:**
    -   **사용자 A는 이체 작업을 마치면 배타 락을 해제합니다.**
    -   **이로써 다른 사용자가 해당 계좌에 접근할 수 있게 됩니다.**
-   **사용자 B의 작업 재개:**
    -   **사용자 B는 대기 중이었던 락을 얻어 이제 해당 계좌에 접근할 수 있게 됩니다.**
    -   **사용자 B는 계좌 잔액을 조회하고 50,000원을 차감하여 업데이트합니다.**
-   **최종 상태:**
    -   **계좌 잔액: 850,000원**

**이렇게 락을 사용하여 동시에 여러 사용자가 공유 자원에 접근하는 경우, 충돌을 방지하고 데이터 일관성을 유지할 수 있다. 배타 락은 획득한 트랜잭션이 해당 자원에 대한 완전한 권한을 가질 수 있도록 하며, 이를 통해 안정적이고 예측 가능한 트랜잭션 수행이 가능해진다.**

### **결론 ✍🏻**

**사용자 A와 B의 동시 접근에서 락 처리의 과정을 알아보았다. 락은 여러 사용자가 동시에 공유 자원에 접근할 때 데이터 일관성을 유지하기 위한 핵심적인 메커니즘이다.사용자 A와 B가 동시에 같은 계좌에서 자금 이체를 시도할 때, 락은 충돌을 방지하고 예측 가능한 트랜잭션을 보장한다. 배타 락을 획득한 트랜잭션이 해당 자원에 대한 완전한 권한을 가지며, 다른 트랜잭션은 대기 상태로 전환되어 충돌이 발생하지 않는다.**
